language: objective-c
osx_image: xcode7
env:
  global:
  - APP_NAME="Hello-World"
  - SCHEME_NAME="Hello-World"
  - SCHEME_TESTS_NAME="Hello-WorldTests"
  - 'DEVELOPER_NAME="iPhone Distribution: Datacom (3W2D35BGJW)"'
  - PROFILE_NAME="Hello_World"
  - secure: xmQm4qrjpzouOgCHPPxdZ70WjRViR298e5jsEgDimoE9d5l3T8SUe9WZXTgvnzY6ErkNCPevktHKyF7ASyPctIfvhcuU3dwxEnGXjE0jTPeEuiqRMTjRUFC9axR87lG7qM1GNZU3/mWlTlAu4ymMxmDYrQjih9HD857UredCpU+fkobzP+4L4tHEWpwOmxZqUlkx7fHQbixgp5ZxzH04JN1Apx1GXYHnPC/4GCM1pNBwGQfE3njl6gGMDEPAYdlwADqo0y4Pza3YpZIpqp8UINpF5bI+NKyHzNfZZDFGVjMImQjmXjBiVTX/F43VhSA5SzzXLxFiNKNVL92DCOivfik23r5e9sLL+jnJ84Xomi0kIuGavXvyOigf3MrBfb/+u/X50NNLYxkeC6jsgOoLne8XIqQlfvjl7SHXIwksqsxv/y6aslr2+B521KYw0XeQ9mgbsOQS47Xsb/XIZ14ZmLA3YrFYGseO4ur14ZnZGu5Ev4h3R1zVQIVn+Ozktg/A38wjlIPtSYotLV9n+cwD8N4Qi1MfIfHQVhkpBWPB3EFYN45mcBF/4nuIrwdGy/Et4P7sq7RvOmQeK+Yx5T0nESYOMJDJs/iAyK3GlTTAC8oEQ41nLpwh7Bxm8YAULIA2Au/APTFjdGxsrhjK922LL+h6qdmG3eSH7G13oJnBofk=
  - secure: UIhWjgKWyCti2AsR63GsMb0/7poTD3+bnvERaabGF+nUHvC6GXCymgfgmlfeAYU+v5592YgY9yoVnWd6dOvPcZOhwCTEINfo3npVLWI9yhSJl1tjVc2lzbnOE6UGRuQLIWmdRYraG9Yy9w7aKdueHrrrwQmtD47TmJPs/6sHgzlmx9MaqjO1aUALI2GtZoFO0NQDXspEW8uED0s2FX4zcXJZyg0ta5+rnRNpbDlWoyOU8w9dNUeJmaaL0XYB30R3ylSlay0h31w0d51C4SHwfaBl/Q25I5m2XYqJONA9H+tFPqGmZ6h9gzpW8FCw1ICSjTqF4WUMCMzxsBTFH1D7xDbvsS3GXq9AQ9sxwvue0TOOXWmcfYY88Ej/NW5eFtrKrNKwzCo6fDBoX1v1FFzja2vByPj6ciEnHJhHu6BheIXKgf9BY4oIspLTP32e+UdBpBoRXiw4oTI+HUl6pB2mv7kpgUhWD+CaejOyrQBNC8BJP/yNiiX5pj5qd17XA+klBh4iRMlNo/FW5xoHRTQDCXZe1nNSY5/7Hh8/VLPqPOTvUr8mXoYVIxcInueYnZodI5JwEb2Fh/3lIx6yClOWEQkp2YcLA34tlfO7Dsd93YGahbrCJr4bdxGTTNeiclYJzteCjIgsraAw7gi32XaUJX/oyPM3EESYKHXo2F6wxoU=
  - secure: NFYD5Mypn1mgd8pb5jvvx6QXBTIT8HHzJ0zy+nHx+1c8eEsDL6y5NFvIJw7jiOEQiSpBf+9sBL7KRda1zWL3OvUB6aWuHvrgExT7J1XLwdihOhNx5HUuV5R3MUCAz8YGSW1Q+vbGvTk0Om0d1vXc0moXWNFbrcL5Q7xyWzMzXK52lcDzk8ggIfWs2/99665uAakeIbDD2XEX9kvxbv9htBybTwEMutFPX2A5f8zLrS5VR1kB8Kp9aK/HRsc1SiiH7TatVIZvuvOSHQV8OjC5vq14sXYAoMXf2qWu+F226BSRMdttCm+F+6iUfIFY5vMF7j2aIl2wtdNrGGbtqZNiCVezBbAbwDwgFhFewMGjs3kxwR9etgrzwdBn80L8TUGeV7qGVkgF0WA1VMhi9zAk6rt6kMul9dqm++n8E+oKFgxmiYj1C7quJi0xwWZTrIjDUK5uy7xbAYYV6VK13e0A6gxKW7nevnjciZ5cbthoTaow6CFrnZmo5PEXLtuoGxNMLWVEoUStVGrf+gZzAAt9CX/C7CI/QXqQww/fJ1uRkLQgI8NJ4lke6s0WaJqDAmUEy5B1x6SHEunEj29EGi7E/7yd/wZDTXVRgF5al9t3nP8Nihih43ZTh3bgIPWlxtNmbqfJ2QEoFEq7OP/TfNr6cFc9zU019oHqmKF27/JfX98=
  - secure: hwJmcOo/uwUX4u+oK2b+kdGCSeWHGIheB0FwNRmM8DKuEXmvc/qQ1PB3R7LGA09vArUQHqTI1UC9xZymdbAaOl2fg0jEXawEZqrhcK2ELcKG84/auVLzgYKrBbE9UorfK7oOgEmQHedMBcChgISNr1AnbA40dlpQHWVupdlvRBO5tunBt64Yla65jdcxkZzTg27J3aBA8sXqmlW+88L9J8twCTBnfAvH5Ofn0cNcF68fmO78FSQ3Z/WOHl1+34pvdm6/YV/FfXxMG9b4ANI/ryilJR+f2D78UEXjRT1hyzbIQwKcVM19GbwL5+V3F/URGJ8ZLWnT5gy0XA2K/Db4U6G660UKJhHMvxYYjp3TVcRoIHNgVGItYzu9yAwdoy+rynVe39qojfq7lgIrCOgRsv7ZME6RIc5Qs/FxwLLJFDBx41yf55WybiTXhWmVb8Qygj8FKrvrLcKEfmGTQHYQh1jTYgrovSl/uHpUL58ncPJL7g58q3CaeON88NtGXDuWOTqvRyQNhv3LpBeTqe0VV5MQklmnSivR6rAdxrT95zKX9O64tJcd2QKz4JUUp2e1bHcdW2AezvNyctoLiUHy30cRQW50yG6HPNrF79SaW8cotxfJeP92PsmGqMzuZA5Z+wNwT2saNg90h/RA+3WpTLxXajTd117mvHxQiPluqqg=
before_script:
- brew update
- brew outdated xctool || brew upgrade xctool
- pod install
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/profile/Hello_World.mobileprovision.enc -d -a -out scripts/profile/Hello_World.mobileprovision
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.cer.enc -d -a -out scripts/certs/dist.cer
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.p12.enc -d -a -out scripts/certs/dist.p12
- "./scripts/add-key.sh"
script:
# Build the workspace
- xctool -workspace $APP_NAME.xcworkspace -scheme $SCHEME_NAME build -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
# Test the workspace
- xctool -workspace $APP_NAME.xcworkspace -scheme $SCHEME_TESTS_NAME test -parallelize -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
# Release the project
- xctool -workspace $APP_NAME.xcworkspace -scheme $SCHEME_NAME -sdk iphoneos -configuration Release OBJROOT=$PWD/build SYMROOT=$PWD/build ONLY_ACTIVE_ARCH=NO 'CODE_SIGN_RESOURCE_RULES_PATH=$(SDKROOT)/ResourceRules.plist'
after_success:
- "./scripts/sign-and-upload.sh"
after_script:
- "./scripts/remove-key.sh"